<mxfile host="app.diagrams.net">
  <diagram name="RAG Agent Flow">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Nodes -->
        <mxCell id="user" value="1. User" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="60" y="80" width="140" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="ui" value="2 &amp; 16. MartinUI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="260" y="80" width="180" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="node" value="3,9,10,13. Node.js API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="500" y="80" width="200" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="litellm" value="3,4,8,10,12. LiteLLM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="780" y="80" width="180" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="kb" value="4–7. Bedrock Knowledge Base" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="780" y="220" width="220" height="80" as="geometry"/>
        </mxCell>

        <mxCell id="os" value="6–7. OpenSearch Vector Store" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="1080" y="220" width="220" height="80" as="geometry"/>
        </mxCell>

        <mxCell id="llm" value="10–11. LLM (Bedrock model)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="1080" y="80" width="220" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="udr" value="14–15. UDR Server" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="500" y="260" width="200" height="60" as="geometry"/>
        </mxCell>

        <!-- Edges: main RAG pipeline -->
        <mxCell id="e1" value="1" style="endArrow=block;html=1;" edge="1" parent="1" source="user" target="ui">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e2" value="2" style="endArrow=block;html=1;" edge="1" parent="1" source="ui" target="node">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e3" value="3" style="endArrow=block;html=1;" edge="1" parent="1" source="node" target="litellm">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e4" value="4" style="endArrow=block;html=1;" edge="1" parent="1" source="litellm" target="kb">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e5" value="5–6" style="endArrow=block;html=1;" edge="1" parent="1" source="kb" target="os">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e6" value="7" style="endArrow=block;html=1;" edge="1" parent="1" source="os" target="kb">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e7" value="7–8" style="endArrow=block;html=1;" edge="1" parent="1" source="kb" target="litellm">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e8" value="8" style="endArrow=block;html=1;" edge="1" parent="1" source="litellm" target="node">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e9" value="9–10" style="endArrow=block;html=1;" edge="1" parent="1" source="node" target="litellm">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e10" value="10" style="endArrow=block;html=1;" edge="1" parent="1" source="litellm" target="llm">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e11" value="11–12" style="endArrow=block;html=1;" edge="1" parent="1" source="llm" target="litellm">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e12" value="12" style="endArrow=block;html=1;" edge="1" parent="1" source="litellm" target="node">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e13" value="13" style="endArrow=block;html=1;" edge="1" parent="1" source="node" target="ui">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Citation resolution via proxy -->
        <mxCell id="e14" value="14 (click citation)" style="endArrow=block;dashed=1;html=1;" edge="1" parent="1" source="ui" target="node">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e15" value="14–15" style="endArrow=block;dashed=1;html=1;" edge="1" parent="1" source="node" target="udr">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e16" value="15" style="endArrow=block;dashed=1;html=1;" edge="1" parent="1" source="udr" target="node">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e17" value="15–16 JSON {url}" style="endArrow=block;dashed=1;html=1;" edge="1" parent="1" source="node" target="ui">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
